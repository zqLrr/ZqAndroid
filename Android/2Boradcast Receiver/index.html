
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="个人技术wiki">
      
      
        <meta name="author" content="Zq">
      
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.8">
    
    
      
        <title>Boradcast Receiver - ZqAndroid</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.4b4a2bd9.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#boradcast-receiver" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../.." title="ZqAndroid" class="md-header__button md-logo" aria-label="ZqAndroid" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ZqAndroid
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Boradcast Receiver
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="ZqAndroid" class="md-nav__button md-logo" aria-label="ZqAndroid" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    ZqAndroid
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Android
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Android
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1%E5%AE%89%E5%8D%93%E5%AD%A6%E4%B9%A0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Android 初识
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../2Android%E5%A4%A7%E7%BA%B2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Android 大纲
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    应用场景
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    广播注册
  </a>
  
    <nav class="md-nav" aria-label="广播注册">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    静态注册
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    动态注册
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    广播接收者动态注册和静态注册的区别
  </a>
  
    <nav class="md-nav" aria-label="广播接收者动态注册和静态注册的区别">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    接收特定权限的广播
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    广播发送
  </a>
  
    <nav class="md-nav" aria-label="广播发送">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    普通广播
  </a>
  
    <nav class="md-nav" aria-label="普通广播">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    显式广播和隐式广播
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    有序广播
  </a>
  
    <nav class="md-nav" aria-label="有序广播">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    有序广播的优先级
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    本地广播
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    粘性广播
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    发送给特定的广播
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#onreceive-context" class="md-nav__link">
    onReceive 参数  context
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app" class="md-nav__link">
    未启动的App如何收到广播
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="boradcast-receiver">Boradcast Receiver</h1>
<blockquote>
<p>即广播接收器，用于监听/接收Android应用分发的各类广播并做出相应的响应。</p>
</blockquote>
<h2 id="_1">应用场景</h2>
<ol>
<li>监听系统事件：如开机广播，网络连接与断开，屏幕开启与关闭等</li>
<li>不同组件间通信（多个Activity/service，包括不同应用间）</li>
<li>多线程通信</li>
</ol>
<p>3、广播类型：无序广播、有序广播和粘性广播（超出10s）</p>
<p>4、生命周期：从调用开始到onReceiver()方法执行完毕结束。（一般不超过10s,会出现ANR）</p>
<p>5、实现原理：观察者模式（基于<strong>消息发布/订阅模式的事件驱动模型</strong>）</p>
<p>​   广播模型中包含三个角色：</p>
<ol>
<li>消息发布者（广播发布者）</li>
<li>消息中心（AMS，即Activity Manager Service）</li>
<li>消息订阅者（广播接收者）</li>
</ol>
<p>原理流程：</p>
<p>1.广播接受者通过Binder机制在AMS中注册监听</p>
<p>2.广播发布者通过Binder机制向AMS发送广播</p>
<p>3.AMS根据发送者的需求，在已注册表中获取到合适的广播接受者（根据Intent-filter，Permission）</p>
<p>4.AMS将广播发送给合适的广播接受者的消息循环队列中</p>
<p>5.广播接受者通过消息循环获取到广播并回调onReceive()</p>
<h2 id="_2">广播注册</h2>
<p>注意：</p>
<ul>
<li>不要在onReceiver中进行耗时操作</li>
<li>不要在onReceiver中开启异步任务</li>
<li>receiver的注册有数量限制，系统限制是1000个，动态注册的广播在不需要时，必须销毁。</li>
</ul>
<h3 id="_3">静态注册</h3>
<ul>
<li>新建一个Broadcast Receiver子类，修改其函数</li>
<li>在AndroidManifest.xml中通过<receive>标签进行申明</li>
</ul>
<h3 id="_4">动态注册</h3>
<ul>
<li>在代码中通过registerReceiver(BroadcastReceiver receiver, IntentFilter filter)来动态注册广播</li>
</ul>
<h2 id="_5">广播接收者动态注册和静态注册的区别</h2>
<table>
<thead>
<tr>
<th>动态注册</th>
<th>静态注册</th>
</tr>
</thead>
<tbody>
<tr>
<td>在程序中进行</td>
<td>在AndroidManifest.xml中定义</td>
</tr>
<tr>
<td>活动销毁时，广播接收器也要unRegisterReceiver()</td>
<td>为常驻广播，即使应用处于非运行状态，也可接收</td>
</tr>
<tr>
<td>优先级较高，且可以控制注册与注销，开销更小，生命周期可控</td>
<td>生命周期不易控制</td>
</tr>
<tr>
<td>支持隐式intent和显式intent</td>
<td>Android 8 之后隐式intent不支持sendboardCast,支持显式intent</td>
</tr>
</tbody>
</table>
<h3 id="_6">接收特定权限的广播</h3>
<ul>
<li>首先，在AndroidManifest.xml中定义新的权限SEND_XXX，例如：</li>
</ul>
<pre><code class="language-xml">&lt;permission android:name=&quot;com.android.SEND_XXX&quot;
            android:protectionLevel=&quot;normal&quot;/&gt; 
//定义权限规则：权限的名称必须遵循 包名+.+字符串 的规则，详细属性见下图
</code></pre>
<p><img alt="定义权限" src="/Users/zhangqian20/git profile/ZqAndroid/docs/png/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBASGVpa28tQW5kcm9pZA==,size_20,color_FFFFFF,t_70,g_se,x_16.png" /></p>
<p>然后，在接受者app的Androidmanifest.xml中的<receiver> tag里添加权限SEND_XXX的声明</p>
<pre><code class="language-xml">&lt;!-- 声明自定义权限 --&gt;
&lt;uses-permission android:name=&quot;com.android.permission.SEND_XXX&quot; /&gt;

&lt;receiver android:name=&quot;.MyBroadcastReceiver&quot;   
         android:permission=&quot;com.android.permission.SEND_XXX&quot;&gt;   
   &lt;intent-filter&gt;  
        &lt;action android:name=&quot;com.android.XXX_ACTION&quot; /&gt;   
   &lt;/intent-filter&gt;  
&lt;/receiver&gt; 
</code></pre>
<p>同时，发送者也需要在Androidmanifest.xml中声明权限。</p>
<h2 id="_7">广播发送</h2>
<h3 id="_8">普通广播</h3>
<p>sendBroadcast(),sendOrderedBroadcast()和sendStickyBroadcast()</p>
<pre><code class="language-java">//发送广播
Intent intent = new Intent();  
intent.setAction(&quot;com.itlao5.broadcast&quot;);  
intent.putExtra(&quot;data&quot;, &quot;data&quot;);  
sendBroadcast(intent);
</code></pre>
<h4 id="_9">显式广播和隐式广播</h4>
<blockquote>
<p>显式和隐式是Intent的概念</p>
</blockquote>
<p>静态注册Android8 之后不支持隐式，若要支持隐式需要+Flag,或者加上包名</p>
<pre><code class="language-java">public static final int FLAG_RECEIVER_INCLUDE_BACKGROUND = 0x01000000;
intent.addFlags(0x01000000);
intent.setPackage(getPackageName());
</code></pre>
<pre><code class="language-java">//静态注册
//显式广播
try {
  Intent intent = new Intent(MainActivity.this, Class.forName(&quot;com.example.androiddemo.BroadcastReceiver.testReceiver&quot;));
  //intent.setAction(&quot;staticFilter&quot;);
  intent.putExtra(&quot;data&quot;, &quot;test BoardCast&quot;);
  sendBroadcast(intent);
} catch (ClassNotFoundException e){
  e.printStackTrace();
}
//隐式广播
Intent intent = new Intent();
intent.setAction(&quot;staticFilter&quot;);
intent.putExtra(&quot;data&quot;, &quot;test BoardCast&quot;);
intent.addFlags(0x01000000);
sendBroadcast(intent)；
</code></pre>
<h3 id="_10">有序广播</h3>
<blockquote>
<p>有序广播是存在接收优先级的广播，可以使用setResult系列、getResult系列及abort（中止）系列API来处理不同优先级的广播。</p>
</blockquote>
<pre><code class="language-java">// 创建一个 Intent 对象，指定广播的动作
Intent intent = new Intent(&quot;com.example.ORDERED_ACTION&quot;);
// 添加额外的数据到 Intent 中（可选）
intent.putExtra(&quot;message&quot;, &quot;Hello, world!&quot;);

// 发送有序广播
sendOrderedBroadcast(intent, null);
</code></pre>
<h4 id="_11">有序广播的优先级</h4>
<ul>
<li>添加方式</li>
</ul>
<p><code>java
  //静态注册
   &lt;intent-filter android:priority="1000"&gt;&lt;/intent-filter&gt;
  //动态注册
   intentFilter.setPriority(10);</code></p>
<p>Android 对于广播的优先级定义为优先级数值越大，则优先级越高，实际上有以下效果，使用优先级一般是有序广播，有序广播是同步进行的。</p>
<ul>
<li>发送有序广播</li>
</ul>
<table>
<thead>
<tr>
<th>广播注册类型</th>
<th>实际效果</th>
</tr>
</thead>
<tbody>
<tr>
<td>全部是静态注册广播</td>
<td>数值越大，优先级越低</td>
</tr>
<tr>
<td>全部是动态注册广播</td>
<td>数值越大，优先级越高，优先级相同的已先注册的优先</td>
</tr>
<tr>
<td>既有动态注册广播又有静态注册广播</td>
<td>当只有一个动态注册的广播时，动态注册的广播优先级永远高于静态注册的广播，且静态注册的广播是数值越大，优先级低<br />当有多个动态注册的广播时，按照注册的顺序来接收广播</td>
</tr>
</tbody>
</table>
<ul>
<li>发送无序广播</li>
</ul>
<p>广播是无序的，是不考虑优先级的，因为执行顺序不确定，也无法使用setResult系列、getResult系列及abort（中止）系列API。</p>
<h3 id="_12">本地广播</h3>
<blockquote>
<p>本地广播是一种特定于应用程序的广播机制，在应用程序内部进行广播传递，而不会对其他应用程序产生影响</p>
</blockquote>
<pre><code class="language-java">// 创建一个 Intent 对象，指定广播的动作
Intent intent = new Intent(&quot;com.example.MY_LOCAL_ACTION&quot;);
// 添加额外的数据到 Intent 中（可选）
intent.putExtra(&quot;message&quot;, &quot;Hello, world!&quot;);
// 发送本地广播
LocalBroadcastManager.getInstance(context).sendBroadcast(intent);
</code></pre>
<p>本地广播提高了传送数据的安全性，并节省了系统资源的开销。</p>
<p>发送的本地广播，静态注册的广播收不到，因此如果有静态注册的广播不适用本地广播。</p>
<h3 id="_13">粘性广播</h3>
<blockquote>
<p>粘性广播（Sticky Broadcast）是一种特殊类型的广播，在发送后会一直保留广播的信息，直到下一次发送者发送同样动作的普通广播或应用程序结束。</p>
</blockquote>
<pre><code class="language-java">// 发送粘性广播
Intent stickyIntent = new Intent(&quot;com.example.STICKY_ACTION&quot;);
stickyIntent.putExtra(&quot;message&quot;, &quot;Hello, world!&quot;);
sendStickyBroadcast(stickyIntent);
</code></pre>
<p>适用场景：</p>
<ol>
<li><strong>应用程序状态更新</strong>：当应用程序状态发生变化时，例如网络连接状态、电池电量、应用程序运行状态等，可以发送粘性广播，以便后续打开应用程序的用户能够获取到最新的状态信息。</li>
<li><strong>应用程序内部通信</strong>：在应用程序内部的不同组件之间进行通信时，可以使用粘性广播传递数据，以便后续注册的接收者能够获取到之前发送的数据。</li>
<li><strong>事件历史记录</strong>：当需要记录应用程序中发生的事件历史记录时，可以使用粘性广播保存事件信息，以便后续分析或查看。</li>
<li><strong>数据同步</strong>：在数据同步过程中，可以使用粘性广播传递同步结果或进度信息，以便后续处理或显示。</li>
<li><strong>应用程序初始化</strong>：在应用程序初始化过程中，可能需要发送一些初始化信息或状态更新广播，以便后续注册的接收者能够获取到初始化完成后的状态信息。</li>
</ol>
<h3 id="_14">发送给特定的广播</h3>
<p>在AndroidManifest.xml中，我们可以配置</p>
<pre><code class="language-xml">&lt;permission android:name = &quot;com.android.permission.XXX&quot;/&gt; 
</code></pre>
<p>然后在发送广播时</p>
<pre><code class="language-java">sendBroadcast(&quot;com.android.XXX_ACTION&quot;, &quot;com.android.permission.XXX&quot;);  
</code></pre>
<p>此时，就只有在广播接收的应用中在AndroidManifest.xml中添加对应的XXX权限，才能正常接收到该广播。</p>
<pre><code class="language-xml">&lt;uses-permission android:name=&quot;com.android.permission.XXX&quot;&gt;&gt;&lt;/uses-permission&gt;  
</code></pre>
<h2 id="onreceive-context">onReceive 参数  context</h2>
<p>如果是静态注册的Broadcast，context.toString()输出为：android.app.ReceiverRestrictedContext@e5d8f65</p>
<p>如果是动态注册的Broadcast，context.toString()输出为：com.example.test.MainActivity@84dfef5</p>
<p>静态与动态注册的的Broadcast，context.getPackageName()输出都为：com.example.test</p>
<p>无论静态还是动态注册的Broadcast，都跑在广播所在app的进程</p>
<h2 id="app">未启动的App如何收到广播</h2>
<blockquote>
<p>Android 3.1以后新增Stopped机制，如果App未启动在系统中记录为以下形式，是Stopped状态</p>
<p><pkg name="com.example.test" stopped="true" /></p>
<p>系统广播中添加了FLAG_EXCLUDE_STOPPED_PACKAGES，因此在stopped状态下无法收到广播。</p>
</blockquote>
<p>看一下这两个Flag:</p>
<pre><code class="language-java">/**
 * If set, this intent will not match any components in packages that
 * are currently stopped.  If this is not set, then the default behavior
 * is to include such applications in the result.
 */
public static final int FLAG_EXCLUDE_STOPPED_PACKAGES = 0x00000010;
/**
 * If set, this intent will always match any components in packages that
 * are currently stopped.  This is the default behavior when
 * {@link #FLAG_EXCLUDE_STOPPED_PACKAGES} is not set.  If both of these
 * flags are set, this one wins (it allows overriding of exclude for
 * places where the framework may automatically set the exclude flag).
 */
public static final int FLAG_INCLUDE_STOPPED_PACKAGES = 0x00000020;
</code></pre>
<p>简单地说，带有<code>FLAG_EXCLUDE_STOPPED_PACKAGES</code>的广播不会被发送给stopped状态的app，而两者都有的情况下以<code>FLAG_INCLUDE_STOPPED_PACKAGES</code>为准。这就是stopped机制，能在一定程度上防范流氓软件恶意监听系统广播，而<code>FLAG_INCLUDE_STOPPED_PACKAGES</code>则相当于留给开发者用于自定义广播的后门了。</p>
<p>因此，发送广播时，应加上FLAG_INCLUDE_STOPPED_PACKAGES</p>
<pre><code class="language-java">// By default broadcasts do not go to stopped apps.
intent.addFlags(Intent.FLAG_EXCLUDE_STOPPED_PACKAGES);
</code></pre>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.footer", "navigation.indexes"], "search": "../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.81fa17fe.min.js"></script>
      
    
  </body>
</html>